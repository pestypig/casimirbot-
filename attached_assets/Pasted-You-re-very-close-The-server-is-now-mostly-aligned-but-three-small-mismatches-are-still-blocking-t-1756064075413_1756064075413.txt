You’re very close. The server is now mostly aligned, but three small mismatches are still blocking the visualizer. They explain the exact checkpoint readout (“WebGL context — missing / Shaders linked — no program / Grid buffers — 0/0 / θ-scale — invalid / Ridge mode — undefined”).

What’s wrong (and why it causes a black screen)

concurrentSectors can be 0 → sectors=0 → no buffers

In getSystemMetrics you clamp with Math.max(0, …). If the live state ever reports 0, the UI ends up with 0 live sectors. Many engines (including yours) skip grid allocation until sectors ≥ 1, so you see “Grid buffers — 0/0 floats” and shader link never kicks off.

γ_VdB default is 1 on the server, but the UI expects ≈2.86e5

Your “Energy Pipeline — hover” panel says:

γ_geo × q × γ_VdB = 26³ × 1.00 × 2.9e+5
θ-scale expected: 5.03e+3


The metrics endpoint currently uses:

const gammaVdB = s.gammaVanDenBroeck ?? 1;


That drops θ-scale by ~2.86e5×, which your renderer flags as “θ-scale — invalid.” Give it the same default the pipeline/UI use.

The engine reads some viewer knobs at the top level, not only under viewer

Your response places ridgeMode, physicsParityMode, and a computed thetaScale under viewer. The inspector shows “Ridge mode — undefined,” which means the client that emits those checkpoints looks at top-level fields. Duplicating these at the root unblocks its init gate so it will create a GL context and link shaders.

Minimal, surgical fixes (apply all three)
A) Never allow 0 live sectors
// getSystemMetrics
-  const concurrent = Math.max(0, s.concurrentSectors || 0);
+  const concurrent = Math.max(1, s.concurrentSectors || 1); // must be ≥1 to allocate buffers

B) Use the same γ_VdB default the UI expects
// viz block inside getSystemMetrics
-    const gammaVdB = s.gammaVanDenBroeck ?? 1;
+    const gammaVdB = s.gammaVanDenBroeck ?? 2.86e5; // align with Energy Pipeline default

C) Mirror critical viewer knobs at the root
  res.json({
    // ...existing fields...
    viz,
    modelMode: "calibrated-single-pass",
+   // top-level viewer knobs (some clients read these here)
+   ridgeMode: 1,
+   physicsParityMode: false,
+   thetaScale: viz.thetaScale_FR_like,
    // viewer hint object (keep too)
    viewer: {
      overlayMode: "single-pass",
      ridgeMode: 1,
      colorMode: "theta",
      physicsParityMode: false,
      thetaScale: viz.thetaScale_FR_like
    }
  });


(You already fixed the other biggies: camel-cased dutyEffectiveFR on /api/helix/pipeline, and sectorStrobing now returns the live concurrent sectors.)