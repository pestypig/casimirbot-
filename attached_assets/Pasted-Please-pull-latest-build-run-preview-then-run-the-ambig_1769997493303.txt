Please pull latest, build, run preview, then run the ambiguity‑resolver validation.

Build (same as deploy):
bash -lc "VITE_HELIX_ASK_JOB_TIMEOUT_MS=600000 npm run build && node scripts/deploy-clean.cjs && npm prune --omit=dev"

Run (same as deploy):
env NODE_ENV=production PORT=5000 HOST=0.0.0.0 NOISEGEN_STORAGE_BACKEND=replit FAST_BOOT=0 REMOVE_BG_PYTHON_BIN=python SKIP_MODULE_INIT=0 DEFER_ROUTE_BOOT=0 HEALTH_READY_ON_LISTEN=1 VITE_HELIX_ASK_MAX_TOKENS=4096 VITE_HELIX_ASK_CONTEXT_TOKENS=4096 LLM_LOCAL_CONTEXT_TOKENS=4096 LLM_LOCAL_MAX_TOKENS=2048 HELIX_ASK_JOB_TIMEOUT_MS=600000 LLM_LOCAL_SPAWN_TIMEOUT_MS=600000 HELIX_ASK_BELIEF_UNSUPPORTED_MAX=0.95 HELIX_ASK_BELIEF_SUPPORT_MIN_RATIO=0.25 HELIX_ASK_BELIEF_SUPPORT_MIN_TOKENS=2 HELIX_ASK_RATTLING_PERTURB=1 HELIX_ASK_VARIANT_SELECTION=1 HELIX_ASK_VARIANT_MIN_SENTENCES=2 HELIX_ASK_VARIANT_MIN_RATIO=0.5 HELIX_ASK_TRAINING_TRACE=1 HELIX_ASK_EVIDENCE_CRITIC=1 HELIX_ASK_EVIDENCE_CLAIM_GATE=1 HELIX_ASK_EVIDENCE_CLAIM_MAX=6 HELIX_ASK_EVIDENCE_CLAIM_MIN_RATIO=0.2 HELIX_ASK_EVIDENCE_CLAIM_MIN_TOKENS=1 HELIX_ASK_EVIDENCE_CLAIM_SUPPORT_RATIO=0.5 HELIX_ASK_AMBIGUITY_GATE=1 HELIX_ASK_AMBIGUITY_RESOLVER=1 HELIX_ASK_AMBIGUITY_SHORT_TOKENS=4 HELIX_ASK_AMBIGUITY_MIN_SCORE=8 HELIX_ASK_AMBIGUITY_MARGIN_MIN=4 HELIX_ASK_AMBIGUOUS_TERM_MIN_LEN=5 HELIX_ASK_AMBIGUOUS_MAX_TERMS=2 HELIX_ASK_LONGPROMPT_CHUNK_TOKENS=420 HELIX_ASK_LONGPROMPT_CHUNK_OVERLAP=80 HELIX_ASK_LONGPROMPT_TOPK_CANDIDATES=18 HELIX_ASK_LONGPROMPT_TOPM_SELECTED=8 HELIX_ASK_LONGPROMPT_CARD_TOKENS=256 HELIX_ASK_LONGPROMPT_MAX_CARDS=12 HELIX_ASK_LONGPROMPT_TRIGGER_TOKENS=640 HELIX_ASK_LONGPROMPT_OVERHEAD_TOKENS=360 HELIX_ASK_OVERFLOW_RETRY=1 HELIX_ASK_OVERFLOW_RETRY_POLICY=drop_context_then_drop_output_then_retry HELIX_ASK_JOB_STALE_MS=1200000 ENABLE_ESSENCE_PROPOSALS=0 ENABLE_ESSENCE_JOBS=0 node dist/index.js

Tests (API with debug=true + traceId):
Ambiguity probes (should CLARIFY):
- “What’s a cavity?”
- “Define lattice.”
- “What’s a bubble?”
- “What’s a ledger?”

Control probes (should NOT clarify):
- “In this repo, what is a Casimir cavity? Cite files.”
- “What is a warp bubble in this codebase?”
- “Explain the curvature ledger panel.”

For each prompt report:
traceId, answer snippet, intent_id/domain/tier, topic_tags, answer_path,
debug.gates.ambiguity (resolverApplied, reason, tokenCount, topScore, margin, candidates, gateApplied, terms),
and whether the response was a clarifying question.
