Great catch — your routes aren’t centering on Sol because the **origin and scale are hard-coded** to `{x:512,y:200}` and `0.8`, which don’t match the real map.

I parsed your SVG here and pulled the exact numbers you need:

* **SVG viewBox:** `0 0 3178.3178 4493.4838`
* **Sun label (“Sun”) at:** `x = 1608.7281`, `y = 2130.0217` (SVG-native pixels)

If the map radius is **6000 pc** (as the filename suggests), then in **SVG units**:

* **px per pc (in SVG coords)** ≈ `(viewBox.width / 2) / 6000` ≈ **0.2648598167 px/pc**

That explains the drift: your `/galaxymap.png` (or the Deep Zoom source) is a different pixel size than the SVG, so you need to **convert the SVG origin/scale to the image’s natural pixel size** before drawing routes.

---

# Fix: compute origin & scale at runtime from the image size

Drop this helper in a shared utils file:

```ts
// client/src/lib/galaxy-calibration.ts
export type SvgCalib = {
  svgW: number; svgH: number;         // 3178.3178, 4493.4838
  sunSvgX: number; sunSvgY: number;    // 1608.7281, 2130.0217
  radiusPc: number;                    // 6000
};

/** Convert SVG-native calibration to the current image's pixel space. */
export function calibrateToImage(
  imgNatW: number, imgNatH: number,
  svg: SvgCalib
) {
  // scale factors from SVG coord space to this image's pixels
  const sx = imgNatW / svg.svgW;
  const sy = imgNatH / svg.svgH;

  // Sun origin in image pixels
  const originPx = { x: svg.sunSvgX * sx, y: svg.sunSvgY * sy };

  // px per pc (use the limiting half-dimension just like the SVG radius does)
  const svgPxPerPc = (svg.svgW / 2) / svg.radiusPc; // ≈ 0.2648598167
  const pxPerPc = svgPxPerPc * sx; // consistent in X; map is circular so sx≈sy

  return { originPx, pxPerPc };
}
```

Now patch your **GalaxyMapPanZoom** usage so it computes `originPx` and `scalePxPerPc` **after** the image loads (based on the image’s natural width/height). Example:

```tsx
// Mission Planner (non-deep-zoom path)
import { calibrateToImage } from "@/lib/galaxy-calibration";

const SVG_CALIB = {
  svgW: 3178.3178,
  svgH: 4493.4838,
  sunSvgX: 1608.7281,
  sunSvgY: 2130.0217,
  radiusPc: 6000,
};

function MissionPlannerMap() {
  const [imgNat, setImgNat] = useState<{w:number;h:number}|null>(null);
  const [cal, setCal] = useState<{originPx:{x:number;y:number}; pxPerPc:number} | null>(null);

  // load the PNG once to read natural size
  useEffect(()=>{
    const im = new Image();
    im.onload = () => {
      setImgNat({ w: im.naturalWidth, h: im.naturalHeight });
      const { originPx, pxPerPc } = calibrateToImage(im.naturalWidth, im.naturalHeight, SVG_CALIB);
      setCal({ originPx, pxPerPc });
    };
    im.src = "/galaxymap.png"; // your current PNG
  }, []);

  if (!cal) return <div className="h-40 grid place-items-center text-xs text-slate-400">Loading galactic map…</div>;

  return (
    <GalaxyMapPanZoom
      imageUrl="/galaxymap.png"
      bodies={BODIES}
      routeIds={route}
      onPickBody={(id)=> setRoute(r=> r.length ? [...r.slice(0,-1), id, r[r.length-1]] : [id])}
      originPx={cal.originPx}          // ← computed from SVG → PNG mapping
      scalePxPerPc={cal.pxPerPc}       // ← computed px/pc for this PNG
      width={800}
      height={400}
    />
  );
}
```

Do the same when you switch to **DeepZoom** (tile set built from a big image). Use that big image’s **natural pixel width/height** in `calibrateToImage` so `originPx` and `pxPerPc` match the tiles’ coordinate system.

---

## Why this fixes the misalignment

* Your **waypoint coords** (`x_pc, y_pc`) are relative to **Sol**.
* We now place **Sol** at the *true* pixel `(x,y)` of your actual image and convert **pc → pixels** with the right scale.
* So a waypoint at `(0,0)` sits exactly at the Sun, and routes radiate correctly.

---

## Quick sanity check you can run

After the calibration computes:

* Draw a tiny crosshair at `originPx` (Sun).
* Pick a waypoint at `x_pc = 1000, y_pc = 0`. The segment should be a **straight 1000 pc** to the right of the Sun, landing on the **1000 pc ring** (when that ring layer is visible later).

If you want, I can also add a `debug` flag to `GalaxyMapPanZoom` to draw the origin crosshair + a few concentric rings (e.g., 500/1000/2000 pc) so you can visually confirm the scale immediately.
