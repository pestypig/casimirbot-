Here’s a **copy-paste prompt** you can give Replit’s “Edit with AI” to fix the build error and make the repo Render-ready.

---

### Replit Edit Prompt

```
Goal: Make this repo deploy cleanly on Render as a Dockerized web service for the “buffer-node” app. Fix the Docker build error “COPY src ./src not found” by generating the right Dockerfile for the current layout, adding a .dockerignore, and ensuring the server binds to PORT and 0.0.0.0. Also align Coinbase endpoints and env var names.

Do the following edits:

1) Detect project layout
   - If there is a TypeScript source folder with tsconfig.json at ./src and a build output at ./dist (or we can compile to dist), generate a **multi-stage Dockerfile** that builds TS -> JS and runs `node dist/server.js` (or `dist/index.js` if that’s the entry).
   - If there is **no ./src** and the runtime entry is `simple.js` (or another JS file), generate a **single-stage runtime Dockerfile** that copies the working tree and runs `node simple.js`.
   - Never COPY a folder that doesn’t exist.

2) Create/replace **Dockerfile**
   - Base image: `node:20-alpine`
   - Target platform: `--platform=linux/amd64`
   - App must listen on `process.env.PORT` and host `0.0.0.0`.
   - Expose 3000; CMD runs the detected entry file.
   - Do not COPY `.env`.

   Multi-stage template (use only if ./src exists and we build TS):
   ---
   FROM --platform=linux/amd64 node:20-alpine AS builder
   WORKDIR /app
   COPY package*.json ./
   RUN npm ci
   COPY tsconfig.json ./
   COPY src ./src
   RUN npm run build

   FROM --platform=linux/amd64 node:20-alpine AS runner
   ENV NODE_ENV=production
   WORKDIR /app
   COPY package*.json ./
   RUN npm ci --omit=dev
   COPY --from=builder /app/dist ./dist
   # COPY public ./public  # only if it exists
   RUN addgroup -S app && adduser -S app -G app
   USER app
   EXPOSE 3000
   CMD ["node", "dist/server.js"]  # or "dist/index.js" if that’s our entry
   ---

   Runtime-only template (use if there’s no ./src and we run simple.js):
   ---
   FROM --platform=linux/amd64 node:20-alpine
   ENV NODE_ENV=production
   WORKDIR /app
   COPY package*.json ./
   RUN npm ci --omit=dev && npm cache clean --force
   COPY . .
   RUN addgroup -S app && adduser -S app -G app
   USER app
   EXPOSE 3000
   CMD ["node", "simple.js"]  # replace with actual entry if different
   ---

3) Create/replace **.dockerignore** with:
```

.git
node\_modules
dist
.env
\*.log
Dockerfile
docker-compose.yml

````
(Do NOT ignore `src`.)

4) Server binding & health
- Ensure the server calls: `app.listen(Number(process.env.PORT || 3000), '0.0.0.0')`.
- Ensure a health route exists: `GET /health` returns `{ status: 'OK' }`.

5) Coinbase endpoints & env names
- OAuth authorize URL: `https://login.coinbase.com/oauth2/auth`
- OAuth token URL: `https://login.coinbase.com/oauth2/token`
- Read balances with `/v2/accounts` (API base `https://api.coinbase.com/v2`).
- Advanced Trade base: `https://api.coinbase.com/api/v3` and brokerage endpoints under `/brokerage/*`.
- HMAC prehash for brokerage: `timestamp + METHOD + path + body`, digest base64 with the **raw API secret**.
- In the brokerage client, support both env pairs:
  `COINBASE_API_KEY` / `COINBASE_API_SECRET`
  **or**
  `COINBASE_ADVANCED_API_KEY` / `COINBASE_ADVANCED_API_SECRET`
  (Use whichever is present; warn if neither is set.)

6) .env.example
- Include only placeholders (no secrets):
  ```
  PORT=3000
  BASE_URL=http://localhost:3000
  SESSION_SECRET=replace_me
  COINBASE_CLIENT_ID=
  COINBASE_CLIENT_SECRET=
  COINBASE_REDIRECT_URI=http://localhost:3000/oauth/callback
  COINBASE_API_KEY=
  COINBASE_API_SECRET=
  # or
  # COINBASE_ADVANCED_API_KEY=
  # COINBASE_ADVANCED_API_SECRET=
  RPC_URL=
  ETHERSCAN_API_KEY=
  OPENAI_API_KEY=
  ```
- If our OAuth routes are `/oauth/authorize` and `/oauth/callback`, keep that path in the example redirect.

7) Output a README section “Deploy on Render (Docker)” with:
- Health check path `/health`
- Required env vars: `SESSION_SECRET`, `COINBASE_CLIENT_ID`, `COINBASE_CLIENT_SECRET`, `COINBASE_REDIRECT_URI`, plus one brokerage API key pair.
- Note to set the Coinbase redirect URI to the Render domain exactly.

8) Final validation:
- Print which Dockerfile variant you generated (multi-stage vs runtime-only).
- List the detected entry file used by CMD.
- Confirm `/src` is only copied if it exists.
- Show a short summary of modified/created files.

Make these edits now.
````

---

Paste that into Replit’s AI editor. When it finishes, skim the new **Dockerfile**, **.dockerignore**, and the updated Coinbase service file to confirm paths/envs. Then push to GitHub and deploy on Render → **Web Service (Docker)**.
