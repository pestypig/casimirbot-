quick checklist

gammaVanDenBroeck_vis is present in /api/helix/pipeline and fed to both REAL/SHOW engines.

gammaVanDenBroeck_mass is not used by render paths (only metrics).

thetaScaleExpected shows in the debug panel and stays stable across reloads.

viewAvg=true, ridgeMode=0, tonemapExp/zeroStop are fixed (no mode seasoning).

First paint is gated until thetaScaleExpected + lc exist (no “flash then fade”).

tiny helper to display & assert θ consistency

Drop this near your inspector panel and call it after every engine.updateUniforms(...):

function thetaGainExpected({
  gammaGeo, qSpoilingFactor, gammaVdB, dutyEffectiveFR
}: {gammaGeo:number; qSpoilingFactor:number; gammaVdB:number; dutyEffectiveFR:number}) {
  return Math.pow(Number(gammaGeo)||0, 3)
       * (Number(qSpoilingFactor)||1)
       * (Number(gammaVdB)||1)
       * (Number(dutyEffectiveFR)||0);
}

function pctDelta(a:number, b:number){
  if (!isFinite(a) || !isFinite(b) || b === 0) return NaN;
  return (a/b - 1) * 100;
}

// call this with the **bound** uniforms you actually sent to the engine:
function reportThetaConsistency(bound:{
  gammaGeo:number; qSpoilingFactor:number; gammaVdB:number; dutyEffectiveFR:number;
}) {
  const expected = thetaGainExpected(bound);
  // if your engine exposes a live θ-scale, use it; otherwise recompute from the same bound uniforms
  const used = thetaGainExpected(bound);

  const delta = pctDelta(used, expected);
  const msg = `θ-scale — used=${used.toExponential(3)} • expected=${expected.toExponential(3)} • Δ=${isFinite(delta)?delta.toFixed(1):'—'}%`;
  console.log(`[HELIX][θ] ${msg}`);
  return { expected, used, delta };
}


Then in the debug UI, render:

const bound = {
  gammaGeo: pipeline?.gammaGeo ?? 26,
  qSpoilingFactor: pipeline?.qSpoilingFactor ?? 1,
  gammaVdB: pipeline?.gammaVanDenBroeck_vis ?? 1,
  dutyEffectiveFR: (pipeline as any)?.dutyEffectiveFR ?? pipeline?.dutyShip ?? 0
};

const { expected, used, delta } = reportThetaConsistency(bound);


Show a single line:

θ-scale (physics-only): {expected.toExponential(3)} • Δ vs used: {isFinite(delta)? `${delta.toFixed(1)}%` : '—'}
