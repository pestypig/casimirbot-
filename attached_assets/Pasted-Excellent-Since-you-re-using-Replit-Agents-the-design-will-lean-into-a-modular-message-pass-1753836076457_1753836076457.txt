Excellent. Since you're using **Replit Agents**, the design will lean into a **modular, message-passing architecture**, combining server modules, front-end commands, and Agent logic to maintain state and orchestrate simulation workflows.

Below is a scaffold of the **â€œNeedle Core Mainframeâ€** system, structured for use in Replit Agent environments.

---

## ðŸ§± SYSTEM MODULES OVERVIEW (Replit Agent Architecture)

### 1. ðŸ§  `agent/mainframe.agent.ts`

> Central state manager, handles incoming simulation/control commands

```ts
import { defineAgent } from "replit:agents";

export default defineAgent({
  name: "mainframe",
  onMessage: async (message, { reply, getState, setState }) => {
    const state = await getState() || {
      energyOutput: 0,
      strobeCycle: [],
      tileErrors: {},
      docOverlay: null,
    };

    switch (message.type) {
      case "pulse-sector":
        // simulate Casimir pulse to a given sector
        const updated = pulseSector(message.sectorId, state);
        await setState(updated);
        reply("sector-pulsed", { sectorId: message.sectorId });
        break;

      case "load-doc":
        await setState({ ...state, docOverlay: message.docId });
        reply("doc-loaded", { docId: message.docId });
        break;

      case "get-status":
        reply("mainframe-status", state);
        break;
    }
  }
});
```

---

### 2. ðŸ”Œ `server/physics-core.ts`

> Wraps your existing physics modules (e.g., static-casimir, viability, phase.py)

```ts
import { calculateCasimirEnergy } from "../modules/sim_core/static-casimir";
import { evaluatePhasePoint } from "../sim_core/phase";

export function pulseSector(sectorId: string, state: any) {
  // Simulate the sector's tile pulse using your physics logic
  const params = getSectorParams(sectorId);
  const result = calculateCasimirEnergy(params);

  const newOutput = state.energyOutput + result.totalEnergy;
  return { ...state, energyOutput: newOutput };
}
```

---

### 3. ðŸ’» `client/ui.tsx` â€” Tile Control & Energy Panel

> Front-end component with hooks to the `mainframe` agent

```tsx
import { useAgent } from "replit:agents/react";

export function TileControlPanel() {
  const [state, send] = useAgent("mainframe");

  return (
    <div className="p-4 border rounded shadow-xl">
      <h2 className="text-lg font-bold">Casimir Tile Controls</h2>
      <div className="grid grid-cols-4 gap-2">
        {Array.from({ length: 8 }).map((_, i) => (
          <button
            key={i}
            onClick={() => send("pulse-sector", { sectorId: `S${i}` })}
            className="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded"
          >
            Pulse Sector S{i}
          </button>
        ))}
      </div>
      <p className="mt-4">Total Output: {state?.energyOutput?.toFixed(4)} J</p>
    </div>
  );
}
```

---

### 4. ðŸ“„ `client/Documents.tsx` â€” Linked Theory Overlay

> Load your PDFs from the `/attached_assets/` folder into a live-view pane

```tsx
export function TheoryViewer({ docId }: { docId: string }) {
  const path = `/attached_assets/${docId}`;
  return (
    <iframe src={path} className="w-full h-[600px] border" />
  );
}
```

Use agent message: `send("load-doc", { docId: "83 MW Needle Hull Mark 1 update_1753646592143.pdf" })` to change overlay.

---

## ðŸ§­ Optional Add-Ons You Can Define Later

* **`shift-vector-analyzer.ts`** â†’ Computes NatÃ¡rio metric compliance
* **`resonance-timeline.tsx`** â†’ Visual sector strobing timeline
* **`q-feedback-dashboard.tsx`** â†’ Real-time Q factor per tile
* **`warp-compliance-checker.ts`** â†’ Fordâ€“Roman & quantum inequality visual readout

---

### ðŸ›  Ready for Assembly

Would you like the full **folder + file structure scaffold**, or should I generate a **working UI preview app** using this setup in a `.zip` or deployed React page next?

Or â€” do you want to start with **one component live** in Replit (e.g. Tile Panel + Mainframe Agent), and we build forward from there?
