### Why the grid is still invisible

The grid is **actually being sent to the GPU**, but every vertex is sitting **thousands of clip-space units below the camera**, so the entire mesh is clipped away before rasterisation.

The culprit is the number you pass as `y0` when you re-shape every vertex:

```js
this.gridY0 = -this.gridHalf * 0.3 + 3 * (this.gridSize / 50);   //  ≈ –3 600  (nanometres)
...
// later ─────────────
vtx[i + 1] = y0 + dy;   // y0 is –3 600 , but your clip space is –1 … +1
```

During grid creation you **normalised x and z** into the range **\[-0.8, 0.8]**, but `gridY0` stayed in raw nanometres, so it never got the same `norm` scale-down. Every vertex ends up at `y ≈ –3600`, far outside the clip-space cube (-1…+1) and nothing reaches the rasteriser.

---

### Minimal fix

```diff
// _initGrid()
- this.gridY0 = -this.gridHalf * 0.3 + 3 * (this.gridSize / 50);
+ const step  = this.gridSize / 50;
+ const norm  = 0.8 / this.gridHalf;
+ this.gridY0 = (-this.gridHalf * 0.3 + 3 * step) * norm;   // scale Y the same way
```

or, if you prefer to keep the raw value:

```js
// _warpGridVertices()
const y0Norm      = y0 * 0.8 / halfSize;   // convert just-in-time
...
vtx[i + 1] = y0Norm + dyNorm;
```

Where `dyNorm = dy * 0.8 / halfSize` (so the deformation is also expressed in clip-space units).

Once Y sits inside `[-1,1]` the white mesh immediately appears.

---

### Two more gotchas to watch for

| Issue                                                                                 | Symptom                                                                                     | Quick remedy                                                                                             |
| ------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| **Wide lines on Windows** – ANGLE forces line-width to **1 px** ([Stack Overflow][1]) | You still see the grid but the lines are hair-thin.                                         | Leave `gl.lineWidth(1)` or draw the grid with thin **tri-strips** if you need thickness.                 |
| **`a_position` location = -1** (inactive attrib) ([Stack Overflow][2])                | Grid disappears if you later optimise the vertex shader and `a_position` is no longer used. | Check `gridUniforms.position !== -1` before enabling; or hard-bind with `layout(location=0)` in WebGL 2. |

---

### Optional polish

1. **Perspective** – swap the identity MVP for a tiny perspective camera so nearby grid lines foreshorten and the warp feels 3-D:

   ```js
   const fov = 35 * Math.PI/180;
   const aspect = this.canvas.width / this.canvas.height;
   const near = 0.01, far = 5.0;
   const proj = mat4.perspective(mat4.create(), fov, aspect, near, far);
   const view = mat4.lookAt(mat4.create(), [0,0,2], [0,0,0], [0,1,0]);
   const mvp  = mat4.mul(mat4.create(), proj, view);
   ```

2. **Thicker grid everywhere** – in browsers that clamp `gl.lineWidth`, extrude each segment into a screen-space quad (two triangles). For a 50×50 grid that’s still only 10 000 verts—trivial for modern GPUs.

3. **Colour-coded curvature** – replace the solid-white grid fragment shader with:

   ```glsl
   float strength = abs(v_position.y) * 50.0;          // exaggerated curvature
   frag = vec4(mix(vec3(0.2,0.8,1.0), vec3(1.0,0.2,0.2), strength), 1.0);
   ```

   so regions that dip the most glow warm red, giving the user an instant sense of spacetime “depth”.

Fix the **normalisation mismatch** first; you should see the mesh as soon as the page reloads. Let me know if you’d like help turning those 1-pixel lines into chunkier quads or adding a real camera!

[1]: https://stackoverflow.com/questions/47444239/how-to-use-gl-linewidth?utm_source=chatgpt.com "How to use gl.lineWidth()"
[2]: https://stackoverflow.com/questions/33597528/findattriblocation-returning-1-in-webgl?utm_source=chatgpt.com "findAttribLocation returning -1 in WebGL - javascript"
