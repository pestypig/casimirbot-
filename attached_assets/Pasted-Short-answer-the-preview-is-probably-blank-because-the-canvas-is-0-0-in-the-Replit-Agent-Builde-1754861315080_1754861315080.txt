Short answer: the preview is probably blank because the canvas is **0×0** in the Replit Agent Builder iframe when your engine boots, so WebGL draws “successfully” to nothing. Two other common culprits I see in your code path: **initialization before layout** and **WebGL being unavailable in the preview sandbox without a visible 2D fallback**.

Here’s what I’d fix first (these are safe drop-ins and don’t change your physics):

# 1) Force a real canvas size before creating the engine

In the page that instantiates `WarpEngine`, add this *before* `new WarpEngine(...)`:

```html
<canvas id="warp"></canvas>
<script>
  const canvas = document.getElementById('warp');

  function setCanvasSize() {
    // Agent Builder iframes often report clientWidth=0 at first paint
    const w = Math.max(1, window.innerWidth  || document.documentElement.clientWidth  || screen.width);
    const h = Math.max(1, window.innerHeight || document.documentElement.clientHeight || screen.height);
    // Set both CSS size and the drawing buffer size
    canvas.style.width  = '100%';
    canvas.style.height = '100vh';
    canvas.width  = w;
    canvas.height = h;
  }

  // Size once now, again on the next frame (after layout), and on resize
  setCanvasSize();
  requestAnimationFrame(setCanvasSize);
  addEventListener('resize', setCanvasSize);
</script>
<script>
  // Now it’s safe to create the engine
  const engine = new window.WarpEngine(document.getElementById('warp'));
</script>
```

Why: in your current engine, `_resize()` uses `canvas.clientWidth/Height`. In the Agent Builder preview those can be 0 until after layout; the GL viewport becomes 0×0 and you see nothing.

# 2) Delay boot until DOM is ready

If you’re injecting the engine in a React/TS app, make sure the instantiation happens after the canvas actually exists:

```js
window.addEventListener('DOMContentLoaded', () => {
  // … run the sizing snippet above, then:
  const engine = new window.WarpEngine(document.getElementById('warp'));
});
```

# 3) Show a visible fallback if WebGL is blocked

Your engine does create a 2D fallback, but it’s easy to miss. Add a tiny banner so you know what’s going on:

```js
const note = document.createElement('div');
note.textContent = 'WebGL fallback active';
Object.assign(note.style, {
  position:'fixed', left:'12px', bottom:'12px', padding:'6px 8px',
  background:'rgba(0,0,0,.5)', color:'#0f0', font:'12px monospace',
  border:'1px solid rgba(255,255,255,.2)', borderRadius:'6px', zIndex:9999
});
setTimeout(() => { if (!engine.gl) document.body.appendChild(note); }, 500);
```

# 4) Check for CSP or inline-script blocks

Agent Builder sometimes uses a stricter Content-Security-Policy. If DevTools shows
“**Refused to execute inline script**” or “**blocked by CSP**”, move your inline scripts to external files and reference them with `<script src="..."></script>` (no `type="module"` unless you’re serving ES modules), or wrap code inside your React bundle instead of inline.

# 5) Make sure paths resolve in the iframe

If you load `client/public/warp-engine-fixed.js` with a relative path that assumes a dev server root, it might 404 in the preview. Open the console → **Network** and confirm the script is loading. If not:

* use a relative path from the page (`./warp-engine-fixed.js`), or
* serve via your bundler’s public folder and reference `/warp-engine-fixed.js`.

# 6) Avoid zero-alpha / depth masking surprises

You already disable depth writes for the quad, then re-enable for the grid; that’s fine. But on some mobile GPUs the grid looks “missing” because `alpha` is too low. If you still don’t see lines after fixing size, temporarily force:

```glsl
// in grid fragment shader
float a = 0.9; // instead of 0.25 + 0.55 * ring
```

# Quick diagnostic checklist in Replit preview

* Open DevTools → **Console**:

  * Do you see “Viewer initialized”? Any `getContext("webgl2")` errors?
* **Elements** tab → select `<canvas id="warp">`:

  * Confirm `width` and `height` **attributes** are > 0 (not just CSS).
* **Network** tab:

  * `warp-engine-fixed.js` status 200? No MIME type or 404 issues?

---

If you want, I can give you a tiny HTML test file that includes all these fixes. Drop it into your project and point the Agent Builder preview at it; if that one renders, we’ll copy the same sizing/boot order back into your main page.
