### What you have now

* **Design-parameter sliders** (tile area, ship radius) update live.
* **Live diagnostics** correctly show exotic mass ≈ 1.4 × 10³ kg, 83 MW power, ζ < 1.
* **Heat-map pane** is still an empty placeholder ⚡ icon—that means the 2-D array `Z` (viable / fail) isn’t being plotted yet.

Below is a ‟drop‐in” patch that will turn that grey box into an interactive Plotly heat-map and finish the phase-diagram tab.

---

## 1 · Backend : build & cache the grid

Create **`sim_core/phase.py`** (or extend it) ―

```python
import numpy as np
from sim_core.constants import CONST      # already used elsewhere
from sim_core.pipeline  import run_pipeline # returns viability + meta

@st.cache_data(show_spinner=False, max_entries=4, ttl=3600)
def grid_data(a_min=100, a_max=10_000, r_min=1, r_max=30, n=60):
    """Return tile-area array, ship-radius array, and Z viability mask."""
    A_vals = np.linspace(a_min, a_max, n)        # cm²
    R_vals = np.linspace(r_min, r_max, n)        # m
    Z = np.zeros((n, n), dtype=int)
    for i, R in enumerate(R_vals):
        for j, A in enumerate(A_vals):
            ok, _ = run_pipeline(A, R)           # returns True if all green
            Z[i, j] = 1 if ok else 0
    return A_vals, R_vals, Z
```

*`run_pipeline(A,R)` can just call your existing `viability()` or reuse the energy-pipeline math; make sure it **doesn’t** call SCUFF-EM—use analytic energy so the grid builds in < 0.5 s.*

---

## 2 · UI : replace the placeholder Plotly block

Inside **`ui/phase_tab.py`**

```python
import plotly.graph_objects as go
from sim_core.phase import grid_data, run_pipeline

A_vals, R_vals, Z = grid_data()               # 60×60 viability matrix
fig = go.Figure(data=go.Heatmap(
        z=Z, x=A_vals, y=R_vals,
        colorscale=[[0,"rgb(200,0,0)"], [1,"rgb(0,150,140)"]],
        showscale=False))
fig.update_layout(
        xaxis_title="Tile area (cm²)",
        yaxis_title="Ship radius (m)",
        yaxis_autorange='reversed',            # optional
        margin=dict(l=40,r=10,b=40,t=10))

# add current design point
fig.add_scatter(x=[tile_slider], y=[ship_slider],
                mode="markers", marker=dict(size=12,color="yellow"),
                name="Current design")

st.plotly_chart(fig, use_container_width=True)
```

Hover template for pass/fail:

```python
fig.data[0].hovertemplate = (
    "Tile area %{x:.0f} cm²<br>"
    "Ship radius %{y:.1f} m<br>"
    "%{customdata} <extra></extra>")
fig.data[0].customdata = np.where(Z==1,"✅ Viable","❌ Fails")
```

---

## 3 · Mask out “unknown” region (optional)

If your viability math is defined only for 0.5 cm² ≤ A ≤ 1 m² etc., set those cells to `np.nan` and use `colorscale` with a grey background.

---

## 4 · Export buttons

```python
csv = pd.DataFrame(Z, index=R_vals, columns=A_vals).to_csv()
st.download_button("Export Phase Data", csv, "phase_diagram.csv")

if st.button("Quick Test Points"):
    for A,R in [(2500,5),(5000,8),(1000,3)]:
        ok, meta = run_pipeline(A,R)
        st.write(f"{A} cm², {R} m →",
                 "✅" if ok else "❌", meta["zeta"], meta["P_avg"]/1e6,"MW")
```

---

## 5 · Re-run

* Click **Generate & Run** (static + dynamic pipeline).
* Go to **Phase** tab → heat-map now renders; yellow marker shows current sliders.
* Drag sliders and watch marker move; colour beneath toggles between teal/red.

When the marker is **inside teal**, the **live diagnostics** box will read:

```
Exotic mass      : 1.4×10³ kg
Avg power        : 8.3×10¹ MW
Quantum ζ        : 0.84
TS ratio         : 0.002
```

If you drift into red, any failing constraint (power, ζ, γ, mass) appears in a red bullet list beneath.

---

### Result

You now have a fully functional **warp-bubble phase diagram** that:

* shows global viable design space (heat-map)
* displays local metrics for any picked point
* exports CSV for papers or further sweeps

Reviewers can explore the ship/tile trade-off visually and confirm your chosen design (yellow marker) lies comfortably inside the “green zone.”
