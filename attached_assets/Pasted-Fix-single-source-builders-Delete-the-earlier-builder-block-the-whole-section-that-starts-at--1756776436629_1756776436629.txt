Fix (single-source builders)

Delete the earlier builder block (the whole section that starts at // Pane builders (only pane-specific spice added here) through the end of its buildSHOW function). That removes one set of exports.

Replace the remaining builder block with this canonical, single set (merges the desired behavior and tonemap defaults, and never ships θ from the UI):

/** Pane builders — single source of truth (θ never shipped from UI) */
export function buildREAL(wu: WarpUniforms) {
  return {
    ...wu,
    physicsParityMode: true,
    ridgeMode: 0,
    viewAvg: true,
    // REAL visuals use FR directly; collapse sectors so engine sees the averaged duty
    dutyEffectiveFR: wu.dutyEffectiveFR,
    dutyCycle: wu.dutyEffectiveFR,
    sectors: 1,
    sectorCount: 1,
    vShip: 0,
    // Mass-pocket γ (physical), visual γ kept only for logging/UI
    gammaVanDenBroeck_mass: wu.gammaVanDenBroeck_mass,
    gammaVanDenBroeck_vis: wu.gammaVanDenBroeck_vis,
    // safe tonemap defaults for REAL
    exposure: wu.exposure ?? 3.5,
    zeroStop: wu.zeroStop ?? 1e-6,
    // never ship UI theta
    thetaScale: undefined,
    u_thetaScale: undefined,
  };
}

export function buildSHOW(
  wu: WarpUniforms,
  opts?: { T?: number; boost?: number; userGain?: number }
) {
  const T = clamp(N(opts?.T, 0.70), 0, 1);
  const boost = Math.max(1, N(opts?.boost, 40));
  return {
    ...wu,
    physicsParityMode: false,
    ridgeMode: 1,
    viewAvg: true,               // SHOW’s display mass = 1.0, averaging state not downscaling mass
    // SHOW uses the local duty/sectors from the pipeline (no FR collapse)
    dutyCycle: wu.dutyCycle,
    sectors: wu.sectors,
    sectorCount: wu.sectorCount,
    vShip: 1,
    gammaVanDenBroeck_vis: wu.gammaVanDenBroeck_vis,
    curvatureGainT: T,
    curvatureBoostMax: boost,
    userGain: Math.max(1, N(opts?.userGain, 2)),
    // safe tonemap defaults for SHOW
    exposure: wu.exposure ?? 6,
    zeroStop: wu.zeroStop ?? 1e-7,
    // never ship UI theta
    thetaScale: undefined,
    u_thetaScale: undefined,
  };
}


Make the imports consistent everywhere:

In WarpRenderInspector.tsx, import the builders only as:

import { normalizeWU, buildREAL, buildSHOW } from "@/lib/warp-uniforms";


(Some copies of the file still import buildRealPacket/buildShowPacket—remove those and use buildREAL/buildSHOW.)

In WarpBubbleCompare.tsx, it already imports the correct names:

import { normalizeWU, buildREAL, buildSHOW } from "@/lib/warp-uniforms";


(Keep this.)

While you’re in cleanup mode, ensure helpers aren’t duplicated in the render files—each of these has bitten you earlier:

Only one paneSanitize per file (you have multiple variants across copies of WarpRenderInspector.tsx).

Only one sanitizeUniforms per file.