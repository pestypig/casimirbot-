Patch B — server/energy-pipeline.ts
What this fixes

Server remains the authority for sectorCount, concurrentSectors, and dutyEffective_FR.

Publishes a single hint viewMassFractionHint = S_live / S_total the client can adopt as the view fraction for REAL panes.

Ensures standby zeros the physics duty path but still carries stable sector numbers.

Replace (or confirm) the sector / duty block in your calculator and ensure snapshot wiring
// ── Sector & duty authority (server) ──────────────────────────────────────────
const S_total = Math.max(1, Number(state.sectorCount ?? TOTAL_SECTORS ?? 400));
const S_live  = Math.max(1, Number(state.concurrentSectors ?? state.sectors ?? 1));
const dutyLocal = Math.max(0, Math.min(1, Number(state.dutyLocal ?? state.dutyCycle ?? 0.01)));
const zeroStandby = (state.mode === 'standby');

// Ford–Roman effective duty (physics): d_FR = dutyLocal × (S_live / S_total)
const dutyEffective_FR = zeroStandby ? 0 : Math.max(0, Math.min(1, dutyLocal * (S_live / S_total)));

// publish a deterministic view-mass fraction hint for clients
const viewMassFractionHint = S_live / S_total;

result.sectorCount        = S_total;
result.concurrentSectors  = S_live;
result.dutyLocal          = dutyLocal;
result.dutyEffective_FR   = dutyEffective_FR;
result.viewMassFractionHint = viewMassFractionHint;


…and in your snapshot that feeds the UI:

// ── UI-facing snapshot (no θ here; engine computes it) ───────────────────────
return {
  ...result,
  warpUniforms: {
    sectorCount:        result.sectorCount,
    sectors:            result.concurrentSectors,
    dutyLocal:          result.dutyLocal,
    dutyCycle:          result.dutyLocal,
    dutyEffectiveFR:    result.dutyEffective_FR,    // FR authority
    gammaGeo:           26,
    deltaAOverA:        result.qSpoil,
    gammaVanDenBroeck:  result.gammaVanDenBroeck_vis,
    gammaVanDenBroeck_vis:  result.gammaVanDenBroeck_vis,
    gammaVanDenBroeck_mass: result.gammaVanDenBroeck_mass,
    // client can use this as the pane’s REAL fraction
    viewMassFraction:   result.viewMassFractionHint,
    viewAvg:            true,
    // UI-only hint; engine ignores for θ
    thetaScaleExpected: result.thetaScaleExpected,
  },
};


(Your current server already carries these fields, including viewMassFractionHint and the FR wiring; the rewrite simply makes them the explicit authority and keeps θ out of the payload.)