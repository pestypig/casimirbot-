② Frontend: resolve sectors from totalSectors and refetch the pipeline on switch

Your sectorsResolved should prefer systemMetrics.totalSectors (new field above), not systemMetrics.sectorStrobing (which previously meant “concurrent”). And after switching mode, invalidate the pipeline query so pipeline.currentMode flips immediately.

a) sectorsResolved + light-cross loop input

-  const sectorsResolved = useMemo(() => {
-    const s = Number(systemMetrics?.sectorStrobing);
+  const sectorsResolved = useMemo(() => {
+    const s = Number(systemMetrics?.totalSectors ?? systemMetrics?.sectorStrobing);
     if (Number.isFinite(s) && s > 0) return Math.max(1, Math.floor(s));
     const u = Number(sectorsUI);
     return Math.max(1, Math.floor(Number.isFinite(u) ? u : 1));
   }, [systemMetrics?.sectorStrobing, systemMetrics?.totalSectors, sectorsUI]);

-  const lc = useLightCrossingLoop({
-    sectorStrobing: systemMetrics?.sectorStrobing ?? sectorsResolved,
+  const lc = useLightCrossingLoop({
+    sectorStrobing: systemMetrics?.totalSectors ?? sectorsResolved,
     currentSector: systemMetrics?.currentSector ?? 0,
     sectorPeriod_ms: systemMetrics?.sectorPeriod_ms ?? 1.0,
     duty: dutyUI,
     freqGHz: pipeline?.modulationFreq_GHz ?? 15,
     hull: { a: hull.a, b: hull.b, c: hull.c },
     wallWidth_m: 6.0,
   });


b) invalidate pipeline query on mode switch

+ import { useQueryClient } from "@tanstack/react-query";
...
+ const queryClient = useQueryClient();

... // in the quick switch buttons
- onClick={() => {
+ onClick={() => {
    if (!isActive) {
-     switchMode.mutate(m.key as any);
-     setModeVersion(v => v + 1);
-     refetchMetrics();
+     switchMode.mutate(m.key as any, {
+       onSuccess: () => {
+         // make both sides refresh
+         queryClient.invalidateQueries({ queryKey: ['/api/helix/pipeline'] });
+         queryClient.invalidateQueries({ queryKey: ['/api/helix/metrics'] });
+       }
+     });
+     setModeVersion(v => v + 1);
+     refetchMetrics();
    }
 }}


With that, effectiveMode will update via either the pipeline or metrics, and your compareParams.currentMode will actually flip, triggering the bubble update.